# 医薬品名変換ツール (Windows用)

このツールは医薬品コードから医薬品名を検索し、包装形態を考慮した最適な一致を見つけるためのExcel VBAマクロです。

## 必要環境

- Windows 10/11
- Microsoft Excel 2013以降
- Microsoft Forms 2.0 Object Library (参照設定で有効化する必要あり)

## 使用方法

1. `棚名一括設定マクロv5.0.0.xlsm` ファイルを開きます。
2. 初回使用時は、以下の手順でVBA参照設定を確認してください：
   1. Alt + F11 キーを押してVBAエディタを開く
   2. メニューから「ツール」→「参照設定」を選択
   3. リストから「Microsoft Forms 2.0 Object Library」にチェックが入っていることを確認
   4. チェックがなければ追加し「OK」をクリック

3. 医薬品コードシート（シート3）に医薬品名とコードを入力します。
   - F列: 医薬品名
   - G列: 医薬品コード（0から始まる14桁）
   - H列: 包装コード（1から始まる14桁）
   - I列: 販売コード（2から始まる14桁）

4. 設定シート（シート1）のB4セルで包装形態を選択します。
   - バラ包装: 「バラ」と「調剤用」の包装単位で検索
   - 分包品: 「PTP」「分包」「SP」「包装小」「PTP(患者用)」の包装単位で検索

5. 設定シート（シート1）のA7以降に医薬品コードを入力します。
   - コードは自動的に14桁に整形されます。

6. メニューから「開発」タブ→「マクロ」を選択し、「ProcessDrugCodesAndCompare」を選んで「実行」ボタンをクリックします。
   - 開発タブが表示されていない場合は、Excelのオプション設定から追加してください。

## 処理の流れ

1. 実行するとプログレスバーが表示され、処理の進捗状況が確認できます。
2. A列の医薬品コードから対応する医薬品名を検索します。
3. 検索された最初の医薬品名から自動的に包装形態（バラ/PTP等）を判定します。
4. 判定された包装形態で処理を行い、スキップされた項目は別の包装形態で再処理します。
5. これにより、処理速度が向上し、必要な場合のみ別の包装形態を試行します。
6. すべての処理が終わると結果がメッセージボックスに表示されます。

## 最適化機能

1行目から取得した医薬品名の包装形態を分析し、バラ包装の棚なのかPTP等の棚なのかを自動判定します。
判定された形態が最初に処理され、一致しなかった項目のみ他の形態で再処理されます。
これにより、処理速度が大幅に向上し、特に大量データの場合に効果的です。

## ファイル構成

- `棚名一括設定マクロv5.0.0.xlsm` - メインのExcelファイル
- `src/` - VBAモジュールファイル
  - `DrugNameConverter.bas` - メインの変換処理モジュール
  - `MainModule.bas` - 基本機能モジュール
  - `DrugNameParser.bas` - 医薬品名解析モジュール
  - `StringUtils.bas` - 文字列処理ユーティリティ
  - `ShelfManager.bas` - 棚管理モジュール

## トラブルシューティング

プログレスバーが表示されない場合は、VBAエディタでMicrosoft Forms 2.0 Object Libraryへの参照が設定されているか確認してください。 