# 医薬品名変換ツール (Mac版)

このツールは、医薬品コードから医薬品名を検索し、包装形態を考慮して最適な医薬品名を提案するExcel VBAツールです。Mac版は進捗表示にステータスバーを使用しています。

## 主な機能

- 医薬品コードから医薬品名を自動検索
- 包装形態（バラ包装、分包品）に基づいた医薬品名の最適化
- 最初の医薬品名から自動的に包装形態を判定し、処理を最適化
- 進捗状況のリアルタイム表示（ステータスバー使用）
- 強化されたエラーハンドリングによる安定動作

## 動作環境

- macOS 10.13以降
- Excel for Mac 2016以降
- VBAマクロが有効化されていること

## インストール方法

1. このリポジトリをダウンロードまたはクローンします
2. `Mac_DrugNameConverter.xlsm`ファイルをお好みの場所に保存します
3. マクロを有効にしてファイルを開きます

## 使用方法

1. 医薬品コードシートに医薬品コードを入力します（A7セルから下）
2. 設定シートで包装形態を選択します（B4セル）
3. メニューから「ツール」→「マクロ」→「ProcessDrugCodesAndCompare」を実行します

## 処理の流れ

1. 医薬品コードから医薬品名を取得
2. 最初の医薬品名から最適な包装形態を自動判定
3. 判定された包装形態で医薬品名を比較
4. マッチしなかった医薬品は別の包装形態で再処理
5. 結果を表示

## ファイル構成

- `Mac_DrugNameConverter.xlsm`: メインのExcelファイル
- `src/`: VBAソースコード
  - `DrugNameConverter_Mac.bas`: メイン処理モジュール（Mac用）
  - `DrugNameParser_Mac.bas`: 医薬品名解析モジュール
  - `MainModule_Mac.bas`: ユーティリティ関数モジュール

## 医薬品マスターシートについて

医薬品マスターシートは以下の形式で作成してください：

- シート名: 「薬品マスター」
- A列: 医薬品コード（14桁）
- B列: 医薬品名

## 包装形態について

ツールは以下の包装形態を認識します：

- バラ包装: 「バラ」、「調剤用」などの表記
- 分包品: 「PTP」、「分包」、「SP」、「包装小」、「PTP(患者用)」などの表記

## 自動処理の最適化

ツールは最初の医薬品から包装形態を自動判定し、処理を最適化します。これにより、ユーザーは包装形態を明示的に選択する必要がなく、大量のデータを効率的に処理できます。

## トラブルシューティング

- マクロが実行できない場合は、Excelのセキュリティ設定でマクロを有効にしてください。
- エラーが発生した場合は、詳細なエラーメッセージが表示されます。
- 「[マスターシートなし]」と表示された場合は、「薬品マスター」シートが存在するか確認してください。
- 「[コード未登録]」と表示された場合は、該当する医薬品コードが医薬品マスターシートに登録されていません。

## ライセンス

このツールはMITライセンスの下で公開されています。詳細はLICENSEファイルを参照してください。 