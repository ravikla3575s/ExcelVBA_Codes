# インストール手順 (Mac版DrugNameConverter)

## 1. システム要件

- **OS**: macOS 10.13 (High Sierra) 以降
- **アプリケーション**: Microsoft Excel for Mac 2016以降
- **その他**: マクロが有効化されたExcel環境

## 2. ファイルのダウンロード

1. GitHubリポジトリから最新のリリースをダウンロードします
2. ダウンロードしたZIPファイルを解凍します
3. `Mac_DrugNameConverter.xlsm` ファイルをお好みの場所に保存します

## 3. Excelセキュリティ設定の確認

### マクロを有効にする方法

1. Excel for Macを起動します
2. メニューから「Excel」→「環境設定」を選択します
3. 「セキュリティとプライバシー」をクリックします
4. 「マクロセキュリティ」ボタンをクリックします
5. 「警告を表示してマクロを無効にする」または「すべてのマクロを有効にする」を選択します
   - セキュリティのために「警告を表示」オプションを推奨します
6. 「OK」をクリックして設定を保存します

## 4. マスターデータの準備

### 薬品マスターシートの作成

1. `Mac_DrugNameConverter.xlsm` ファイルを開きます
2. 新しいシートを作成し、名前を「薬品マスター」に変更します
3. A列に医薬品コード（14桁）、B列に医薬品名を入力します
   - A1セルには「医薬品コード」、B1セルには「医薬品名」などの見出しを入力します
   - A2セルから実際のデータを入力してください

### 例：マスターデータの形式

| 医薬品コード | 医薬品名 |
|------------|---------|
| 01234567890123 | アムロジピン錠5mg「サワイ」(PTP) |
| 12345678901234 | ロキソプロフェン錠60mg「EMEC」(PTP) |
| ... | ... |

## 5. 初期設定の実行

### 包装形態ドロップダウンリストの設定

1. ファイルを開いたら、「ツール」→「マクロ」→「マクロ...」を選択します
2. マクロ一覧から「SetupPackageTypeDropdown」を選択し、「実行」をクリックします
3. これにより、設定シートのB4セルに包装形態選択用のドロップダウンリストが設定されます

### 使用方法の表示

1. 「ツール」→「マクロ」→「マクロ...」を選択します
2. マクロ一覧から「AddInstructions」を選択し、「実行」をクリックします
3. これにより、設定シートの下部に使用方法の説明が表示されます

## 6. 動作確認

### テスト実行の手順

1. 設定シート（最初のシート）のA7セルから下に医薬品コードをいくつか入力します
2. B4セルで包装形態を選択します（「バラ包装」または「分包品」）
3. 「ツール」→「マクロ」→「マクロ...」を選択します
4. マクロ一覧から「ProcessDrugCodesAndCompare」を選択し、「実行」をクリックします
5. ステータスバー（Excelウィンドウの下部）に進捗状況が表示され、処理が完了すると結果がメッセージボックスで表示されます

## 7. トラブルシューティング

### よくある問題と解決方法

- **マクロが実行できない場合**
  - Excelのセキュリティ設定でマクロが有効になっているか確認してください
  - ファイルを開くときに「コンテンツを有効にする」ボタンをクリックしてください

- **「[マスターシートなし]」と表示される場合**
  - 「薬品マスター」シートが存在するか、名前が正確に一致しているか確認してください

- **「[コード未登録]」と表示される場合**
  - 入力した医薬品コードが薬品マスターシートに登録されているか確認してください
  - コードは14桁になっているか確認してください

- **処理が途中で停止した場合**
  - ステータスバーをクリアするには `Application.StatusBar = False` を実行します
  - 再度マクロを実行してください

## 8. カスタマイズ（上級者向け）

### VBAコードの編集方法

1. Excel for Macで「開発」タブを表示させます
   - 「Excel」→「環境設定」→「リボン」で「開発」にチェックを入れます
2. 「開発」タブの「Visual Basic」をクリックします
3. プロジェクトエクスプローラーでモジュールを選択し、必要に応じてコードを編集します
   - `DrugNameConverter_Mac.bas` - メイン処理モジュール
   - `DrugNameParser_Mac.bas` - 医薬品名解析モジュール
   - `MainModule_Mac.bas` - ユーティリティ関数モジュール

### 新しい包装形態の追加

追加したい包装形態がある場合は、`DetectPackageType`関数内の配列を編集します：

```vba
' bulkPackagesに新しいバラ系包装形態を追加
bulkPackages = Array("バラ", "調剤用", "新しい形態名")

' unitPackagesに新しい分包系包装形態を追加
unitPackages = Array("PTP", "分包", "SP", "包装小", "PTP(患者用)", "新しい形態名")
```

## 9. 更新情報

最新バージョン: 1.0.0
リリース日: 2023年6月1日

### バージョン履歴

- **1.0.0** - 初期リリース
  - Mac用に最適化された医薬品名変換機能
  - ステータスバーによる進捗表示
  - 自動包装形態判定による処理最適化 